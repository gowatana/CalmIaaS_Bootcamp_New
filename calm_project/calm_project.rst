.. _calm_project:

----------------------
Calm: Projectを作成する
----------------------

*この演習の所要時間は約20分です。*

プロジェクトとアカウントの設定
+++++++++++++++++++++

このラボでは、事前に構築された複数のCalmブループリントを活用して、アプリケーションのプロビジョニングを行います。こちらでは事前準備としてプロジェクトとアカウントの設定を行います。

プロジェクトとは、Nutanixクラスタを論理的に分割し、テナントの役割を持つものです。アカウントとは、プロジェクトに紐づく形でリソース起動先のプラットフォームを設定します。

#. **Prism Central** で :fa:`bars` > **サービス** > **Calm** を選択します。

#. 左側のメニューから **Project** を選択し、 **+プロジェクトを作成** をクリックします。

   .. figure:: images/2.png

#. 以下のフィールドに入力し、 **作成** をクリックします。

   - **プロジェクト名** - *あなたのイニシャル*-Project
   - その他のフィールドは空白のまま進めます。

   .. figure:: images/new-3-1.png

#. **アカウントを追加** をクリックし、 **アカウントを選択** から、 **NTNX_LOCAL_AZ** を選択します。

   .. figure:: images/new-3-2.png

#. **クラスタとサブネットの追加/編集** をクリックし、 **あなたに割り当てられたクラスタ** を選択します。

   .. figure:: images/new-3-3.png

#. **ホワイトリストに登録するサブネットを選択** から **Primary** を選択し、 **確認** をクリックします。

#. :fa:`star` をクリックし、 **Primary** をデフォルトのネットワークに設定し、 **アカウントとプロジェクトを保存** をクリックします。

   .. figure:: images/new-3-4.png
   
ユーザー、グループ、ロールの設定
+++++++++++++++++++++

**ユーザー、グループ、ロール** では、Prism Centralと連携されたIDサービス(Active Directory)から参照されるユーザに対してロールを付与し、プロジェクトへの従属関係の設定と認可設定を行います。本演習ではadminアカウントを用いるため、設定は省略します。

環境値の設定
+++++++++++++++++++++

**環境** は、プロジェクト内の各アカウントに紐付けられるVM設定と認証情報のひな形です。 **VM設定** はブループリント作成時にVM設定をクローンすることで入力ミスを防ぎます。 **認証情報** はマーケットプレイスからのブループリント起動にあたり、ブループリント内に設定された秘匿情報に対して **環境** 内の **認証情報** をマッピングして用います。

ここでは、 *あなたのイニシャル*-プロジェクトに更新し、新たに **環境** を追加します。

#. 左側のメニューから **Projects** を選択します。

#. *あなたのイニシャル*-Projectを選択します。

#. **環境** タブを選択します。

#. **環境を構築** をクリックします。

#. 以下入力し、 **次へ** をクリックします。

   - **名前** - *あなたのイニシャル*-Environment
   - **説明(オプション)** - 空白のままで構いません

   .. figure:: images/new_32_env_1.png
       :align: center
       :alt: 環境 - 全般

#. **アカウントを追加** にある **アカウントを選択** をクリックし、 **NTNX_LOCAL_AZ** を選択します。

   .. figure:: images/new_32_env_2.png
       :align: center
       :alt: 環境 - アカウント
       
#. ページ下部の **VM設定** をクリックしてから、 **Windows** タブを選択し、以下の設定を行います。指定のないものはデフォルト値で設定します。

   .. note::
     この環境値をクローンして、新規ブループリント作成時に仮想マシン設定のひな形として使用することが出来ます。

   - **vCPU** - 1
   - **vCPUあたりのコア数** - 1
   - **メモリー(GiB)** - 1
   - **Image** - Windows2016-Japanese.qcow2
   - **ネットワーク アダプタ(NIC)** - **青い+マーク** をクリックし、ドロップダウンで **Primary** を選択し、 **動的** ラジオボタンを選択します。
   - **接続** - **作成時ログインのチェック** をクリックし、 **認証情報** のドロップダウンで **新認証情報追加** を選択します。

   .. figure:: images/new_32_env_3.png
       :align: center
       :alt: 環境 - VM設定_Windows_CPU

   .. figure:: images/new_32_env_4.png
       :align: center
       :alt: 環境 - VM設定_Windows_ディスク

   .. figure:: images/new_32_env_5.png
       :align: center
       :alt: 環境 - VM設定_Windows_変更なし

   .. figure:: images/new_32_env_6.png
       :align: center
       :alt: 環境 - VM設定_Windows_NIC

   .. figure:: images/new_32_env_7.png
       :align: center
       :alt: 環境 - VM設定_Windows_接続

#. 新規認証情報の追加画面で以下入力し、 **完了** をクリックします。

   - **認証情報名** - WIN_VM_ADMIN
   - **ユーザ名** - Administrator
   - **秘密のタイプ** - パスワード
   - **パスワード** - nutanix/4u

   .. figure:: images/new_32_env_8.png
       :align: center
       :alt: 環境 - VM設定_Windows_認証情報

#. ページを上部に戻り、 **VM設定** で **Linux** タブを選択し、以下の設定を行います。指定のないものはデフォルト値で設定します。

   .. note::
     この環境値をクローンして、新規ブループリント作成時に仮想マシン設定のひな形として使用することが出来ます。

   - **vCPU** - 1
   - **vCPUあたりのコア数** - 1
   - **メモリー(GiB)** - 1
   - **Image** - CentOS7.qcow2
   - **ネットワーク アダプタ(NIC)** - **青い+マーク** をクリックし、ドロップダウンで **Primary** を選択し、 **動的** ラジオボタンを選択します。
   - **接続** - **作成時ログインのチェック** をクリックし、 **認証情報** のドロップダウンで **新認証情報追加** を選択します。

#. 新規認証情報の追加画面で以下入力し、 **完了** をクリックします。

   - **認証情報名** - LINUX_VM_CENTOS
   - **ユーザ名** - centos
   - **秘密のタイプ** - パスワード
   - **パスワード** - Nutanix/4u

#. **次へ** をクリックします。前のステップで追加した認証情報が追加されていることを確認します。

   .. note::
     この認証情報をクローンして、マーケットプレイスからのアプリケーション起動時に設定する認証情報のひな形として使用することが出来ます。

#. **環境とプロジェクトを保存** をクリックします。

#. **環境** タブにおいて、 **ブループリントの作成** と **マーケットプレイスの利用量** に青いチェックマークが付いていれば設定に問題ありませんので、次に進みます。

   .. figure:: images/new_32_env_9.png
       :align: center
       :alt: 環境

#. **ポリシー** タブにおいて、 **スナップショット** メニューを選択し、 **+スナップショットポリシーの作成** をクリックします。

#. 以下入力し、 **スナップショットポリシーの保存** をクリックします。

   - **ポリシー名** - *あなたのイニシャル*-Snapshot
   - **スナップショットの有効期限（日数）** - 7 (ローカルスナップショット内のスナップショットルールにて指定します)

   .. figure:: images/snapshotpolicy.png
